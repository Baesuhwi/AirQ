<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yjc.airq.mapper.MatterMapper">
	<!-- 물질 리스트 가져오기 -->
	<select id="matterList"
		resultType="com.yjc.airq.domain.MatterVO">
		select * from matter
	</select>

	<!-- 상품에 서비스 가능한 물질 리스트 등록 -->
	<insert id="productMatterInsert" parameterType="String">
		insert into
		p_measure_matter(matter_code,product_code)
		values(#{matter_code},#{product_code})
	</insert>

	<!-- 상품에 서비스 가능한 물질 리스트 삭제 -->
	<delete id="productMatterDelete" parameterType="String">
		delete from
		p_measure_matter where product_code = #{product_code}
	</delete>

	<!-- 예약자 모니터링 -->
	<select id="reservation" resultType="map">
		select to_char(m.measure_time,'yyyy-mm-dd') measure_time,
		to_number(to_char(avg(measure_value),'99.9')) measure_value
		from measure_data m, iot_info i
		where m.iot_id=i.iot_id and member_id=#{member_id}
		group by m.iot_id,i.member_id, to_char(m.measure_time,'yyyy-mm-dd')
		having to_char(m.measure_time,'yyyy-mm-dd') > sysdate-7
		order by measure_time desc
	</select>
</mapper>